# Evalplus Results JSON Format - Issue and Fix

## Issue
The evalplus evaluation generates a results JSON file (e.g., `samples_t80_p95_n1-sanitized_eval_results.json`) that is valid JSON but formatted as a single line (minified), making it very difficult for humans to read.

## Root Cause
This minified format is the default output from the **evalplus Docker container** (external tool), not from our evaluation scripts. The evalplus tool optimizes for file size by removing all whitespace and formatting.

## Verification
The JSON file **IS valid and parsable** - we can successfully read it with standard JSON tools:
```bash
python3 -m json.tool samples_t80_p95_n1-sanitized_eval_results.json
```

Example of minified format (first line of file):
```json
{"date": "2025-10-20 20:07", "hash": "fe585eb4df8c88d844eeb463ea4d0302", "eval": {"HumanEval/1": [{"task_id": "HumanEval/1", "solution": "from typing import List", "base_status": "fail", "plus_status": "fail"...
```

## Solution Implemented

### Updated eval_humaneval.sh
Added automatic prettification step after evalplus evaluation completes:

**Lines 81-88 (EVAL_ONLY mode):**
```bash
# Prettify the eval results JSON
EVAL_RESULTS="${SANITIZED_INPUT%.jsonl}_eval_results.json"
if [ -f "$EVAL_RESULTS" ]; then
    echo ""
    echo "Step 3: Prettifying eval results..."
    python3 -m json.tool "$EVAL_RESULTS" > "${EVAL_RESULTS%.json}_pretty.json"
    echo "✅ Prettified results saved to: ${EVAL_RESULTS%.json}_pretty.json"
fi
```

**Lines 185-196 (Full pipeline mode):**
```bash
# Step 4: Prettify the eval results JSON
echo ""
echo "Step 4: Prettifying eval results..."
echo "----------------------------------------------------------------------"

EVAL_RESULTS="${SANITIZED_FILE%.jsonl}_eval_results.json"
if [ -f "$EVAL_RESULTS" ]; then
    python3 -m json.tool "$EVAL_RESULTS" > "${EVAL_RESULTS%.json}_pretty.json"
    echo "✅ Prettified results saved to: ${EVAL_RESULTS%.json}_pretty.json"
else
    echo "Warning: Eval results file not found: $EVAL_RESULTS"
fi
```

## Result
Now when you run the evaluation pipeline, you get **two versions** of the results:

1. **Original minified** (133KB): `samples_t80_p95_n1-sanitized_eval_results.json`
   - Machine-readable, optimized for size
   - Generated by evalplus

2. **Prettified** (191KB): `samples_t80_p95_n1-sanitized_eval_results_pretty.json`
   - Human-readable with proper indentation
   - Automatically generated by our script

## Usage
The prettification happens automatically when you run:
```bash
./eval_humaneval.sh
```

Or in eval-only mode:
```bash
EVAL_ONLY="results/humaneval/Qwen/Qwen2.5-Coder-3B/samples_t80_p95_n1.jsonl" ./eval_humaneval.sh
```

## File Size Comparison
- Minified: 133KB (single line)
- Prettified: 191KB (properly formatted)
- Size increase: ~43% for improved readability

## Technical Notes
- The original minified file is preserved (not modified)
- Uses Python's built-in `json.tool` module (no dependencies)
- Works with any JSON file size
- Handles errors gracefully (warns if file not found)
